{% extends 'appMonitor/base.html' %}
{% load static %}
{% load widget_tweaks %}

{% block title %}
Registro de Usuario
{% endblock %}

{% block content %}
<div class="min-h-screen bg-gray-50 flex items-center justify-center px-4 py-8">
    <div class="w-full max-w-md">
        <!-- Card Container -->
        <div class="bg-white rounded-lg shadow-md border border-gray-200 p-8">
            
            <!-- Header with Logo -->
            <div class="flex justify-center mb-8">
                <img src="{% static 'assets/img/logounl.png' %}" alt="Logo" class="h-24 object-contain">
            </div>

            <!-- Title -->
            <h1 class="text-3xl font-bold text-center text-gray-800 mb-8">Registrar nueva cuenta</h1>

            <!-- Messages -->
            {% if messages %}
            <div id="alert-container" class="mb-6 hidden">
                {% for message in messages %}
                <div class="p-4 rounded-lg {% if message.tags == 'success' %}bg-green-50 border border-green-200 text-green-700{% else %}bg-red-50 border border-red-200 text-red-700{% endif %}" role="alert">
                    {{ message }}
                </div>
                {% endfor %}
            </div>
            {% endif %}

            <!-- Form -->
            <form action="" method="POST" id="registerForm">
                {% csrf_token %}

                <!-- Grid 2 Columnas -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    
                    <!-- Nombre -->
                    <div>
                        <label for="{{ form.nombre.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-2">
                            {{ form.nombre.label }}
                        </label>
                        <input 
                            type="text" 
                            name="{{ form.nombre.name }}" 
                            id="{{ form.nombre.id_for_label }}"
                            class="w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition"
                            required>
                        <div id="nombre-error" class="hidden text-red-600 text-sm mt-1">
                            Por favor ingrese su nombre.
                        </div>
                        {% if form.nombre.errors %}
                        <div class="text-red-600 text-sm mt-1">
                            {{ form.nombre.errors|join:", " }}
                        </div>
                        {% endif %}
                    </div>

                    <!-- Apellido -->
                    <div>
                        <label for="{{ form.apellido.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-2">
                            {{ form.apellido.label }}
                        </label>
                        <input 
                            type="text" 
                            name="{{ form.apellido.name }}" 
                            id="{{ form.apellido.id_for_label }}"
                            class="w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition"
                            required>
                        <div id="apellido-error" class="hidden text-red-600 text-sm mt-1">
                            Por favor ingrese su apellido.
                        </div>
                        {% if form.apellido.errors %}
                        <div class="text-red-600 text-sm mt-1">
                            {{ form.apellido.errors|join:", " }}
                        </div>
                        {% endif %}
                    </div>

                    <!-- Cédula -->
                    <div>
                        <label for="{{ form.cedula.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-2">
                            {{ form.cedula.label }}
                        </label>
                        <input 
                            type="text" 
                            name="{{ form.cedula.name }}" 
                            id="{{ form.cedula.id_for_label }}"
                            class="w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition"
                            required>
                        <div id="cedula-error" class="hidden text-red-600 text-sm mt-1">
                            Por favor ingrese su cédula.
                        </div>
                        {% if form.cedula.errors %}
                        <div class="text-red-600 text-sm mt-1">
                            {{ form.cedula.errors|join:", " }}
                        </div>
                        {% endif %}
                    </div>

                    <!-- Email -->
                    <div>
                        <label for="{{ form.email.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-2">
                            {{ form.email.label }}
                        </label>
                        <input 
                            type="email" 
                            name="{{ form.email.name }}" 
                            id="{{ form.email.id_for_label }}"
                            class="w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition"
                            required>
                        <div id="email-error" class="hidden text-red-600 text-sm mt-1">
                            Por favor ingrese un correo válido.
                        </div>
                        {% if form.email.errors %}
                        <div class="text-red-600 text-sm mt-1">
                            {{ form.email.errors|join:", " }}
                        </div>
                        {% endif %}
                    </div>

                    <!-- Teléfono (ancho completo) -->
                    <div class="col-span-1 md:col-span-2">
                        <label for="{{ form.telefono.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-2">
                            {{ form.telefono.label }}
                        </label>
                        <input 
                            type="text" 
                            name="{{ form.telefono.name }}" 
                            id="{{ form.telefono.id_for_label }}"
                            class="w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition"
                            required>
                        <div id="telefono-error" class="hidden text-red-600 text-sm mt-1">
                            Por favor ingrese su teléfono.
                        </div>
                        {% if form.telefono.errors %}
                        <div class="text-red-600 text-sm mt-1">
                            {{ form.telefono.errors|join:", " }}
                        </div>
                        {% endif %}
                    </div>
                </div>

                <!-- Action Buttons -->
                <div class="flex flex-col sm:flex-row gap-4 pt-8">
                    <button 
                        type="button" 
                        onclick="window.location.href='{% url 'salir' %}'"
                        class="flex-1 px-4 py-2.5 bg-gray-500 hover:bg-gray-600 text-white font-medium rounded-lg transition flex items-center justify-center gap-2">
                        <i class="fas fa-arrow-left"></i> Regresar
                    </button>
                    <button 
                        type="submit"
                        class="flex-1 px-4 py-2.5 bg-blue-600 hover:bg-blue-700 text-white font-medium rounded-lg transition">
                        Registrar Usuario
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
    document.getElementById('registerForm').addEventListener('submit', function(event) {
        const form = this;
        const fields = [
            { id: 'nombre', name: 'nombre' },
            { id: 'apellido', name: 'apellido' },
            { id: 'cedula', name: 'cedula' },
            { id: 'email', name: 'email' },
            { id: 'telefono', name: 'telefono' }
        ];

        let isValid = true;

        fields.forEach(field => {
            const inputField = form[field.name];
            const errorDiv = document.getElementById(field.id + '-error');
            
            if (!inputField.value.trim() || (field.name === 'email' && !inputField.value.includes('@'))) {
                errorDiv.classList.remove('hidden');
                isValid = false;
            } else {
                errorDiv.classList.add('hidden');
            }
        });

        if (!isValid) {
            event.preventDefault();
        }
    });

    // Remove error when user starts typing
    const fields = ['nombre', 'apellido', 'cedula', 'email', 'telefono'];
    fields.forEach(fieldName => {
        const field = document.getElementById(fieldName === 'apellido' ? 'id_apellido' : 
                                             fieldName === 'cedula' ? 'id_cedula' :
                                             fieldName === 'telephone' ? 'id_telefono' :
                                             'id_' + fieldName);
        if (field) {
            field.addEventListener('input', function() {
                const errorDiv = document.getElementById(fieldName + '-error');
                if (this.value.trim()) {
                    errorDiv.classList.add('hidden');
                }
            });
        }
    });
</script>
{% endblock %}
